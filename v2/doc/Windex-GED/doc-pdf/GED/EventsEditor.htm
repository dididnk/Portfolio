<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
  <meta http-equiv="content-type" content="text/html; charset=ISO-8859-15" />
  <meta name="author" content="Multimédia SOLUTIONS" />
  <meta name="classification" content="Interface" />
  <link rel="stylesheet" href="../css/style.css" />
  <title>Gestion des évènements</title>
<script type="text/javascript" src="../js/jquery.js"></script>
<script type="text/javascript" type="text/javascript"><!--
jQuery(document).ready( function(){
	if (parent.frames.length!=0) { return; }
	jQuery('h1').eq(0).append('<div class="allHelp"><a href="index.htm">Toute la documentation</a></div>');
});
//-->
</script>
</head>
<body>
<h1 align="center">Gestion des évènements</h1>

<h2>Liste des évènements</h2>


Ce module permet de programmer des actions suite à des évènements se produisant sur les documents.<br>

<p class="screen"><img src="images/screen/EventsEditor.png" alt=""></p>
<br>
Les différents types d'évènements sur lesquels vous pouvez programmer des actions sont :
<ul>
	<li>le document change d'état</li>
	<li>le document change détat au travers d'une transition du Workflow</li>
	<li>une nouvelle note est affectée à un document</li>
	<li>suppression d'une note</li>
	<li>le document est dupliqué dans un autre dossier</li>
	<li>un nouveau dossier est créé</li>
	<li>un document est supprimé</li>
	<li>une document change de nom</li>
	<li>le document est déplacé dans un autre dossier</li>
	<li>le document va être lu</li>
	<li>le document est lu</li>
	<li>le document est téléchargé</li>
</ul>

<div class="Attention"> les évènements peuvent enchaîner des actions antagonistes.<br>
	Par exemple : vous pouvez supprimer un document et lui changer son état !<br>
</div>



Cliquez sur le bouton&nbsp;<img alt="+" src="images/bt-add.png"> pour ajouter un nouvel évènement.<br>
<br>
Cliquez sur le bouton <img alt="x" src="images/bt-del.png"> pour supprimer un évènement. <br>
<br>
Cliquez sur la ligne d'un évènement pour l'éditer.<br>
<br>

<br>

<h2><a name="EventEditor"></a>Edition d'un évènement</h2>
Cet écran permet de créer un évènement qui exécutera des actions.<br>
Dans l'exemple ci-dessous, l'évènement créé déplacera vers le dossier "/webmaster/A_CLASSER" les documents auxquels sera affecté l'état "Nouveau".<br>
<p class="screen"><img src="images/screen/EventEditor.png" alt=""></p>
<br>



Les différents champs d'un évènement :<br>
<table class="tableau"><tbody>
	<tr>
		<td>Nom de l'évènement</td>
		<td>Indiquer ici le nom de l'évènement.</td>
	</tr>
	<tr>
		<td>Type</td>
		<td>Sélectionner le type d'évènement qui déclenchera les actions programmées :
		<ul>
			<li>Sur changement d'état</li>
			<li>Sur transition</li>
			<li>Ajout de document</li>
			<li>Ajout de note</li>
			<li>Suppression de note</li>
			<li>Copie de document</li>
			<li>Création d'un dossier</li>
			<li>Suppression de document</li>
			<li>Renommage de document</li>
			<li>Déplacement de document</li>			
			<li>Document lu <span class="new">Nouveauté</span>: le document à été lu.</li>
			<li>Document va être lu <span class="new">Nouveauté</span> : cet évènement intervient juste avant la lecture du document. 
				Il est donc possible de créer une macro d'action pouvant modifier le document en ajoutant un tampon avec le nom de
				l'utilisateur avant la lecture du document</li>
			<li>Document téléchargè <span class="new">Nouveauté</span> : l'utilisateur à demandé le téléchargement du 
				document au lieu de sa lecture en cliquant sur la fonction "Télécharger" du menu contextuel du document</li>
		</ul>
		</td>
	</tr>
	<tr>
		<td>Commentaire</td>
		<td>Saisir un commentaire</td>
	</tr>
	<tr>
		<td>Etat de destination</td>
		<td>Sélectionner l'état du document</td>
	</tr>
	<tr>
		<td>Transition</td>
		<td>Sélectionner la transition (du Workflow)</td>
	</tr>
	<tr>
		<td>Dossiers et fichiers concernés</td>
		<td>Choisir un des deux modes : 
		<ul>
		<li>"simple" : il permet de sélectionner un dossier "Source" et/ou de "Destination" en
			 cliquant sur le bouton <img src="images/chooserFolder.gif" alt="Dossier"> </li>
		<li>"expert" : il permet de saisir une expression régulière (identique aux expressions régulières du langage Java) identifiant les dossiers</li>
		</ul>
		Le champ "Source" correspond au dossier dans lequel se trouve le document avant l'évènement.<br>
		Le champ "Destination" correspond au dossier dans lequel se trouve le document après l'évènement.<br>
		Cliquer sur le bouton <img src="images/bt-del.png" alt="supprimer" > pour supprimer votre saisie.
		</td>
	</tr>
</tbody></table>
<br>
Les actions seront exécutées après la réalisation de l'évènement.<br>
<br>

<h3>Programmation des actions liées à cet évènement</h3>

<p class="screen"><img src="images/screen/EventAction.png" alt=""/></p>
<br>
Sur chaque action :
<ul>
<li>cliquer sur la case à cocher "Activer" pour l'activer</li>
<li>cliquer sur le bouton <img src="images/bt-del.png" alt="supprimer"/> pour la  supprimer</li>
</ul>
<br>
Pour ajouter une action cliquer sur le bouton <img src="images/bt-add.png" alt="+"/> 
 puis sélectionner le type d'action :
<p class="screen"><img src="images/screen/EventNewAction.png" alt=""/></p>

 <br>
<ul>
<li>
	Le type d'action "Changer d'état" a été sélectionné :
	<p class="screen"><img src="images/screen/EventActionChangeState.png" alt=""/></p>
	Cet état sera affecté au document.<br> 
</li><li>
	Le type d'action "Déplacer le document" a été sélectionné :
	<p class="screen"><img src="images/screen/EventActionMoveDoc.png" alt=""/></p>
	Le document sera déplacé vers le dossier choisi.<br>
</li><li>
	Le type d'action "Supprimer le document" a été sélectionné :
	<p class="screen"><img src="images/screen/EventActionDelDoc.png" alt=""/></p>
	Le document sera supprimé.<br> 
</li><li>
	Le type d'action "Envoyer un message" a été sélectionné :
	<p class="screen"><img src="images/screen/EventActionSendMsg.png" alt=""/></p>
	Un message interne est envoyé aux utilisateurs sélectionnés.<br>
	Une subtitution des variables entre deux "%" par leur valeur respective est effectuée avant la création du message 
		(<a href="#Vars">voir variables disponible dans les évènements</a>).<br>
</li><li>
	Le type d'action "Envoyer un email" a été sélectionné :
	<p class="screen"><img src="images/screen/EventActionSendEmail.png" alt=""/></p>
	Un email est envoyé aux utilisateurs sélectionnés.<br>
	Une subtitution des variables entre deux "%" par leur valeur respective est effectuée avant la création du message 
		(<a href="#Vars">voir variables disponible dans les évènements</a>).<br>
		<span class="new">Nouveauté</span> L'éditeur de texte des courriels permet la gestion de : <br>
		<ul>
		<li>gras, italique</li>
		<li>exposant, indice</li>
		<li>indentation</li>
		<li>annuler la frappe</li>
		<li>puces</li>
		<li>hyperliens</li>
		<li>ligne horizontale</li>
		<li>lien vers image extérieur</li>
		<li>Tableau</li>
		</ul>
</li><li>
	Le type d'action "Exécuter une macro" a été sélectionné :
	<p class="screen"><img src="images/screen/EventActionMacro.png" alt=""/></p>
	Ecriver une macro dans la zone de saisie [<a href="../console/Macro/Macro.htm">voir les macro</a>]<br>
	Cette action exécute un macro langage qui permet de créer des actions non pré-paramêtrées. <br>
	Exemple d'un macro qui envoie un email avec un lien pour lire un document :<br>
		<ul>@ExplorerSendMail(TargetFile,'toto@nothing.com',
			<ul>'mon titre a mois',<br> 
 				@Concat(
 				<ul>
 					'Vous avez un document a lire :  &lt;a href=&quot;http://monserveur:8087',<br>
  	   		ServletURI,<br>
     			'?Agent=Explorer&quot;Order=Show&quot;DocId=',<br>
     			TargetId,<br>
     			'&quot;&gt;',<br>
     			@HtmlEncode(TargetDocName),<br>
     			'&lt;/a&gt;'<br>
     		</ul>
 				),<br>
 				@False,"html")<br>
 			</ul>
 	</ul>
	<br>
</li><li>
	Le type d'action "Message de débogage" a été sélectionné :
	<p class="screen"><img src="images/screen/EventActionDebug.png" alt=""/></p>
	Saisir un message qui s'immprimera dans les fichiers "log" lorsque cet évènement se produira.<br>
	Cette action est une aide au debogage. <br>
</li><li><span class="new">Nouveauté</span>
	Le type d'action "Envoyer un email de changement d'état" a été sélectionné :
	<p class="screen"><img src="images/screen/EventActionSendEmailOfChangeState.png" alt=""/></p>
	Permet d'envoyer aux utilisateurs sélectionnés (champ "Email transmis à") un courriel contenant
	 un hyperlien pointant sur une page proposant les choix de changement d'état du document. 
	 Cet hyperlien permet de choisir l'état du document sans se connecter sur la GED.<br>	 
	 L'hyperlien a une durée de vie limité. Elle est conditionnée par :
		<ul>
			<li>le champ "Durée de validité du lien" qui indique le nombre de jours durant lequel l'hyperlien est utilisable (Variable : %LinkQuer%)</li>
			<li>le champ "Nombre maximumn d'usage du lien" indique le nombre de fois que peut être utilisé l'hyperlien</li>
			<li>si le champ "Nécéssite que l'utilisateur soit connecté" : 
				S'il est à "Oui", l'utilisateur devra se connecter (phase de login) 
				S'il est à "non"  l'utilisateur ne devra pas se connecter. Dans ce cas, il faut indiquer un nom d'utilisateur.</li>
		</ul>
		<br>
		Avant l'envoi du message, dans le corps du texte les variables se trouvant entre deux "%" sont remplacées par 
		leur valeur (<a href="#Vars">voir variables disponibles dans les évènements</a>).<br>
		<br>
		Une subtitution des variables entre deux "%" par leur valeur respective est effectuée avant la création du message 
		(<a href="#Vars">voir variables disponible dans les évènements</a>).<br>
		Lorsque le courriel est envoyé, un hyperlien temporaire est créé vers la GED et permet de changer l'état du document 
		(<a href="#Vars">voir la variable LinkQuery du tableau</a>).
		
</li><li><span class="new">Nouveauté</span>
	Le type d'action "Envoyer un email de lien public"a été sélectionné :
	<p class="screen"><img src="images/screen/EventActionSendEmailOfPublicLink.png" alt=""/></p>
	Permet d'envoyer un email contenant un hyperlien temporaire vers le document.<br>
	 L'hyperlien a une durée de vie limité. Elle est conditionnée par :
		<ul>
			<li>le champ "Durée de validité du lien" qui indique le nombre de jours durant lequel l'hyperlien est utilisable (Variable : %LinkQuer%)</li>
			<li>le champ "Nombre maximumn d'usage du lien" indique le nombre de fois que peut être utilisé l'hyperlien</li>
			<li>si le champ "Nécéssite que l'utilisateur soit connecté" : 
				S'il est à "Oui", l'utilisateur devra se connecter (phase de login) 
				S'il est à "non"  l'utilisateur ne devra pas se connecter. Dans ce cas, il faut indiquer un nom d'utilisateur.</li>
		</ul>
		<br>
		Avant l'envoi du message, dans le corps du texte les variables se trouvant entre deux "%" sont remplacées par 
		leur valeur (<a href="#Vars">voir variables disponibles dans les évènements</a>).<br>
		<br>
		Une subtitution des variables entre deux "%" par leur valeur respective est effectuée avant la création du message 
		(<a href="#Vars">voir variables disponible dans les évènements</a>).<br>
		Lorsque le courriel est envoyé, un hyperlien temporaire est créé vers la GED et permet de changer l'état du document 
		(<a href="#Vars">voir la variable LinkQuery du tableau</a>).
	</li>
</ul>
<br>
<br>
<h3><a name="Vars"></a>Variables disponibles dans les évènements</h3>
Les variables commancant par "Targer" indiquent les documents cibles de l'action<br>
Les variables commancant par "Src" indiquent les documents sources de l'action<br>
Les variables commancant par "Dst" indiquent les documents de destination de l'action<br>
Par exemple dans un évènement de déplacement d'un document, les variables commencant par "Src" correspondent au document d'origne, 
les variables commencant par un "Dst" correspondent au document de destination,
et les variables commencant par "Target" contient les même valeurs que celle commancant par "Dst" (dans ce cas)<br>
Sur une suppression du document les variables commencant par "Dst" n'existe pas !<br>
<br>
<table class="tableau"><thead>
<tr><td>Nom</td><td>Description</td></tr>
</thead>
<tbody>
	<tr><td>ServletURI</td><td>l'URI du serveur.<br> 
		L'URI dans l'url suivante "http://www.lug.com<b>/WindexServer/WindexServer</b>?Agent=Explorer&amp;Order=Show" est /WindexServer/WindexServer<br>
		Par défaut c'est /WindexServer/WindexServer</td></tr>
		<tr><td>TargetId, SrcId,  DstId</td><td>L'identifiant (externe) du docuemnt sur le serveur, peut egale a zero si pas de doc</td></tr>
	<tr><td>TargetFile, SrcFile,  DstFile</td><td>L'objet "File" du docuemnt sur le serveur</td></tr>
	<tr><td>TargetDoc, SrcDoc, DstDoc</td><td>Le chemin du document dans le dépot</td></tr>	
	<tr><td>TargetDocName, SrcDocName, DstDocName</td><td>Le nom du document</td></tr>
	<tr><td>TargetDocPath, SrcDocPath, DstDocPath</td><td>Le chemin du dossier du document dans le dépot</td></tr>
	<tr><td>LinkQuery</td><td><span class="new">Nouveauté</span> Variable contenant la partie "query" de l'hyperlien temporaire de l'action
	 (voir les actions  "Envoyer un email de changement d'état" et "Envoyer un email de lien public").<br> 
	 <br>
		Pour composer un hyperlien complet vous devez taper :<br> 
		&nbsp;&nbsp;&nbsp;&nbsp; http://www.monServeur.com/WindexServer/WindexServer?<b>%LinkQuery%</b><br>
		(Remplacer www.monServeur.com par le nom de votre serveur).
	</td></tr>
	<tr><td>StateComment</td><td><span class="new">Nouveauté</span> Contient le commentaire saisie par l'utilisateur, sur l'acion d'un Workflow demandant un commentaire.</td></tr>	
</tbody>
</table>

</body></html>